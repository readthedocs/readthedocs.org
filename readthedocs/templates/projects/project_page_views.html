{% extends "projects/project_edit_base.html" %}

{% load i18n %}
{% load static %}

{% block title %}{% trans "Page Views" %}{% endblock %}

{% block nav-dashboard %} class="active"{% endblock %}

{% block project-page-views-active %}active{% endblock %}
{% block project_edit_content_header %}{% trans "Page Views" %}{% endblock %}

{% block project_edit_content %}
	<h3>{% trans "Top Viewed Pages" %}</h3>
		<div class="module-list">
      <div class="module-list-wrapper">
        <ul class="long-list-overflow">
          {% for page, count in top_viewed_pages_iter %}
            <li class="module-item">
              {{ page }}
              <span class="right quiet">
                {{ count }} {{ view|pluralize:"s" }}
              </span>
            </li>
          {% empty %}
            <li class="module-item">
              <p class="quiet">
                {% trans 'No date available.' %}
              </p>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>

	<br/>

	<h2>{% trans "Page Views Per Page" %}</h2>
  <form method="GET">
    <select name="page" onchange="this.form.submit()">
      {% for option in all_pages %}
        <option value="{{ option }}" {% if page_path == option %}selected{% endif %}>{{ option }}</option>
      {% endfor %}
    </select>
  </form>
	<canvas id="page-views-per-page" width="400" height="150"></canvas>

{% endblock %}

{% block extra_scripts %}
  <!-- Chart.js v2.8.0 -->
  <script src="{% static 'vendor/chartjs/chartjs.bundle.min.js' %}"></script>
{% endblock %}

{% block extra_links %}
  <!-- Chart.js v2.8.0 -->
  <link rel="stylesheet" href="{% static 'vendor/chartjs/chartjs.min.css' %}">
{% endblock %}

{% block footerjs %}
  var line_chart = document.getElementById("page-views-per-page").getContext("2d");
  var line_chart_labels = {{ page_data.labels|safe }};
  var line_chart_data = {{ page_data.int_data|safe }};

  var line_chart = new Chart(line_chart, {
    type: "line",
    data: {
      labels: line_chart_labels,
      datasets: [{
        label: "# of views for {{ page_path }}",
        data: line_chart_data,
        fill: false,
        borderColor: "rgba(75, 192, 192, 1)",
        pointBorderColor: "rgba(75, 192, 192, 1)",
      }]
    },
  });
{% endblock %}
