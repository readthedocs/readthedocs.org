require=function o(i,s,u){function c(r,e){if(!s[r]){if(!i[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(l)return l(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[r]={exports:{}};i[r][0].call(a.exports,function(e){return c(i[r][1][e]||e)},a,a.exports,o,i,s,u)}return s[r].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,r,t){var o=e("jquery");function a(e){var n=o.Deferred(),a=5;return setTimeout(function t(){o.getJSON(e.url).done(function(e){e.finished?e.success?n.resolve():n.reject({message:e.error}):setTimeout(t,2e3)}).fail(function(e){if(console.error("Error polling task:",e),0<(a-=1))setTimeout(t,2e3);else{var r=e.responseJSON.detail||e.statusText;n.reject({message:r})}})},2e3),n}r.exports={poll_task:a,trigger_task:function(e){var t=o.Deferred(),r=e.url,n={csrfmiddlewaretoken:e.token};return $.ajax({method:"POST",url:r,data:n,success:function(e){a(e).then(function(){t.resolve()}).fail(function(e){t.reject(e)})},error:function(e){var r=e.responseJSON.detail||e.statusText;t.reject({message:r})}}),t}}},{jquery:"jquery"}],"projects/import":[function(e,r,t){var s=e("knockout"),u=e("jquery"),n=e("readthedocs/core/static-src/core/js/tasks");function c(e,r){var t=u("<a>").attr("href",e).get(0);return Object.keys(r).map(function(e){t.search&&(t.search+="&"),t.search+=e+"="+r[e]}),t.href}function l(e,r){var t=this;t.id=s.observable(e.id),t.name=s.observable(e.name),t.slug=s.observable(e.slug),t.active=s.observable(e.active),t.avatar_url=s.observable(c(e.avatar_url,{size:32})),t.display_name=s.computed(function(){return t.name()||t.slug()}),t.filter_id=s.computed(function(){return t.id()}),t.filter_type="org",t.filtered=s.computed(function(){var e=r.filter_by();return e.id&&e.id!==t.filter_id()||e.type&&e.type!==t.filter_type})}function p(e,r){var t=this;t.id=s.observable(e.id),t.username=s.observable(e.username),t.active=s.observable(e.active),t.avatar_url=s.observable(c(e.avatar_url,{size:32})),t.provider=s.observable(e.provider),t.display_name=s.computed(function(){return t.username()}),t.filter_id=s.computed(function(){return t.provider().id}),t.filter_type="own",t.filtered=s.computed(function(){var e=r.filter_by();return e.id&&e.id!==t.filter_id()||e.type&&e.type!==t.filter_type})}function a(e,a){var o=this;o.id=s.observable(e.id),o.name=s.observable(e.name),o.full_name=s.observable(e.full_name),o.description=s.observable(e.description),o.vcs=s.observable(e.vcs),o.organization=s.observable(e.organization),o.html_url=s.observable(e.html_url),o.clone_url=s.observable(e.clone_url),o.ssh_url=s.observable(e.ssh_url),o.matches=s.observable(e.matches),o.match=s.computed(function(){var e=o.matches();if(e&&0<e.length)return e[0]}),o.private=s.observable(e.private),o.active=s.observable(e.active),o.admin=s.observable(e.admin),o.is_locked=s.computed(function(){return o.private()&&!o.admin()}),o.avatar_url=s.observable(c(e.avatar_url,{size:32})),o.import_repo=function(){var t={name:o.name(),repo:o.clone_url(),repo_type:o.vcs(),description:o.description(),project_url:o.html_url(),remote_repository:o.id()},n=u("<form />");n.attr("action",a.urls.projects_import).attr("method","POST").hide(),Object.keys(t).map(function(e){var r=u("<input>").attr("type","hidden").attr("name",e).attr("value",t[e]);n.append(r)});var e=u("<input>").attr("type","hidden").attr("name","csrfmiddlewaretoken").attr("value",a.csrf_token);n.append(e);var r=u("<input>").attr("type","submit");n.append(r),u("body").append(n),n.submit()}}function o(e,r){var i=this;i.config=r||{},i.urls=r.urls||{},i.csrf_token=r.csrf_token||"",i.error=s.observable(null),i.is_syncing=s.observable(!1),i.is_ready=s.observable(!1),i.page_current=s.observable(null),i.page_next=s.observable(null),i.page_previous=s.observable(null),i.filter_by=s.observable({id:null,type:null}),i.accounts_raw=s.observableArray(),i.organizations_raw=s.observableArray(),i.filters=s.computed(function(){var e,r=[],t=i.accounts_raw(),n=i.organizations_raw();for(e in t){var a=new p(t[e],i);r.push(a)}for(e in n){var o=new l(n[e],i);r.push(o)}return r}),i.projects=s.observableArray(),s.computed(function(){var e=i.filter_by(),r=i.page_current()||i.urls["remoterepository-list"];i.page_current()||("org"===e.type&&(r=c(i.urls["remoterepository-list"],{org:e.id})),"own"===e.type&&(r=c(i.urls["remoterepository-list"],{own:e.id}))),i.error(null),u.getJSON(r).done(function(e){var r,t=[];for(r in i.page_next(e.next),i.page_previous(e.previous),e.results){var n=new a(e.results[r],i);t.push(n)}i.projects(t)}).fail(function(e){var r=e.responseJSON.detail||e.statusText;i.error({message:r})}).always(function(){i.is_ready(!0)})}).extend({deferred:!0}),i.get_organizations=function(){u.getJSON(i.urls["remoteorganization-list"]).done(function(e){i.organizations_raw(e.results)}).fail(function(e){var r=e.responseJSON.detail||e.statusText;i.error({message:r})})},i.get_accounts=function(){u.getJSON(i.urls["remoteaccount-list"]).done(function(e){i.accounts_raw(e.results)}).fail(function(e){var r=e.responseJSON.detail||e.statusText;i.error({message:r})})},i.sync_projects=function(){var e=i.urls.api_sync_remote_repositories;i.error(null),i.is_syncing(!0),n.trigger_task({url:e,token:i.csrf_token}).then(function(e){i.get_organizations(),i.get_accounts(),i.filter_by.valueHasMutated()}).fail(function(e){i.error(e)}).always(function(){i.is_syncing(!1)})},i.has_projects=s.computed(function(){return 0<i.projects().length}),i.next_page=function(){i.page_current(i.page_next())},i.previous_page=function(){i.page_current(i.page_previous())},i.set_filter_by=function(e,r){var t=i.filter_by();t.id===e?(t.id=null,t.type=null):(t.id=e,t.type=r),i.filter_by(t),t.id&&i.page_current(null)}}u(function(){var t=u("#id_repo"),n=u("#id_repo_type");t.blur(function(){var e,r=t.val();switch(!0){case/^hg/.test(r):e="hg";break;case/^bzr/.test(r):case/launchpad/.test(r):e="bzr";break;case/trunk/.test(r):case/^svn/.test(r):e="svn";break;default:case/github/.test(r):case/(^git|\.git$)/.test(r):e="git"}n.val(e)})}),o.init=function(e,r,t){var n=new o(r,t);return n.get_accounts(),n.get_organizations(),s.applyBindings(n,e),n},r.exports.ProjectImportView=o},{jquery:"jquery",knockout:"knockout","readthedocs/core/static-src/core/js/tasks":1}]},{},[]);